<% content_for :title, @product_feedback.title %>

<div class="max-w-4xl mx-auto">
  <div class="mb-8">
    <%= link_to product_feedbacks_path, class: "btn btn-ghost btn-sm gap-2" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Back to Feedback
    <% end %>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <div class="flex flex-wrap items-center gap-2 mb-4">
        <span class="badge <%= @product_feedback.status_color %>"><%= @product_feedback.status_display_name %></span>
        <span class="badge badge-outline">
          <%= render_category_icon(@product_feedback.category) %>
          <%= @product_feedback.category_display_name %>
        </span>
      </div>

      <h1 class="text-2xl font-bold mb-4"><%= @product_feedback.title %></h1>

      <div class="flex items-center gap-4 text-sm text-base-content/70 mb-6">
        <span>
          By <%= @product_feedback.user.display_name %>
        </span>
        <span>
          <%= time_ago_in_words(@product_feedback.created_at) %> ago
        </span>
      </div>

      <div class="prose max-w-none mb-6">
        <%= simple_format(@product_feedback.description) %>
      </div>

      <% if @product_feedback.attachments.attached? %>
        <div class="mb-6">
          <h3 class="font-semibold mb-2">Attachments</h3>
          <div class="flex flex-wrap gap-4">
            <% @product_feedback.attachments.each do |attachment| %>
              <% if attachment.image? %>
                <%= link_to rails_blob_path(attachment, disposition: "attachment"), class: "block", target: "_blank" do %>
                  <%= image_tag attachment.variant(resize_to_limit: [200, 200]), class: "rounded-lg border border-base-300" %>
                <% end %>
              <% else %>
                <%= link_to attachment.filename, rails_blob_path(attachment, disposition: "attachment"), class: "link link-primary" %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="flex items-center justify-between pt-4 border-t border-base-300">
        <div id="product-feedback-<%= @product_feedback.id %>-vote">
          <%= render "product_feedbacks/vote_button", product_feedback: @product_feedback %>
        </div>

        <% if @product_feedback.user == current_user %>
          <span class="badge badge-ghost">Your feedback</span>
        <% end %>
      </div>
    </div>
  </div>
</div>
