<%= form_with model: feedback,
              url: form_feedbacks_path(form_definition_id: form_definition.id),
              data: { feedback_target: "form" } do |f| %>

  <%# Validation Errors %>
  <% if feedback.errors.any? %>
    <div class="alert alert-error mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div>
        <% feedback.errors.full_messages.each do |message| %>
          <p><%= message %></p>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Star Rating %>
  <div class="form-control mb-4" data-controller="star-rating">
    <label class="label">
      <span class="label-text font-medium">Rate this form</span>
    </label>
    <%= f.hidden_field :rating, data: { star_rating_target: "input" } %>
    <div class="flex items-center gap-1">
      <% 5.times do |i| %>
        <button type="button"
                class="text-3xl transition-colors cursor-pointer text-base-300 hover:scale-110"
                data-rating="<%= i + 1 %>"
                data-star-rating-target="star"
                data-action="click->star-rating#select mouseenter->star-rating#hover mouseleave->star-rating#leave">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8">
            <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
          </svg>
        </button>
      <% end %>
      <span class="ml-2 text-sm text-base-content/70" data-star-rating-target="label">Select a rating</span>
    </div>
  </div>

  <%# Issue Types Checklist %>
  <div class="form-control mb-4">
    <label class="label">
      <span class="label-text font-medium">What issues did you experience? <span class="text-base-content/50">(select all that apply)</span></span>
    </label>
    <div class="space-y-2">
      <% FormFeedback::ISSUE_TYPES.each do |key, label| %>
        <label class="flex items-center gap-3 cursor-pointer p-2 rounded-lg hover:bg-base-200 transition-colors">
          <%= f.check_box :issue_types,
                          { multiple: true, class: "checkbox checkbox-primary checkbox-sm" },
                          key,
                          nil %>
          <span class="label-text"><%= label %></span>
        </label>
      <% end %>
    </div>
  </div>

  <%# Comment %>
  <div class="form-control mb-4">
    <label class="label" for="feedback_comment">
      <span class="label-text font-medium">Additional comments <span class="text-base-content/50">(optional)</span></span>
    </label>
    <%= f.text_area :comment,
                    rows: 3,
                    class: "textarea textarea-bordered w-full",
                    placeholder: "Tell us more about your experience..." %>
  </div>

  <%# Submit Button %>
  <div class="modal-action">
    <button type="button" class="btn btn-ghost" data-action="click->feedback#close">
      Cancel
    </button>
    <%= f.submit "Submit Feedback", class: "btn btn-primary" %>
  </div>
<% end %>
