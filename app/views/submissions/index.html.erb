<% content_for :title, "My Submissions - CA Small Claims Court" %>

<div data-controller="pull-to-refresh" data-pull-to-refresh-threshold-value="90">
  <div class="fixed top-2 left-1/2 -translate-x-1/2 z-30 transition-all duration-200 opacity-0 -translate-y-6 pull-to-refresh-indicator"
       data-pull-to-refresh-target="indicator">
    <div class="px-4 py-2 rounded-full shadow-lg bg-base-100 border border-base-200 flex items-center gap-2">
      <svg class="w-5 h-5 text-primary transition-transform"
           data-pull-to-refresh-target="icon"
           fill="none"
           stroke="currentColor"
           viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 10l7-7m0 0l7 7m-7-7v18"></path>
      </svg>
      <span class="text-sm text-base-content/80" data-pull-to-refresh-target="label">Pull to refresh</span>
    </div>
  </div>

  <div class="mb-8">
    <h1 class="text-3xl font-bold text-base-content mb-2">My Submissions</h1>
    <p class="text-base-content/70">View and manage your saved form submissions.</p>
  </div>

<% if @submissions.any? %>
  <div class="overflow-x-auto bg-base-100 rounded-lg shadow">
    <table class="table table-zebra w-full">
      <thead>
        <tr>
          <th>Form</th>
          <th>Status</th>
          <th>Progress</th>
          <th>Last Updated</th>
          <th class="text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @submissions.each do |submission| %>
          <tr>
            <td>
              <div class="flex items-center">
                <div>
                  <div class="font-medium text-base-content"><%= submission.form_definition.code %></div>
                  <div class="text-sm text-base-content/60"><%= submission.form_definition.title %></div>
                </div>
              </div>
            </td>
            <td>
              <% case submission.status %>
              <% when "completed" %>
                <span class="badge badge-success gap-2">
                  Completed
                </span>
              <% when "draft" %>
                <span class="badge badge-warning gap-2">
                  Draft
                </span>
              <% else %>
                <span class="badge badge-ghost gap-2">
                  <%= submission.status.titleize %>
                </span>
              <% end %>
            </td>
            <td>
              <div class="flex items-center gap-3">
                <progress class="progress progress-primary w-24" value="<%= submission.completion_percentage %>" max="100"></progress>
                <span class="text-sm text-base-content/70"><%= submission.completion_percentage %>%</span>
              </div>
            </td>
            <td class="text-sm text-base-content/60">
              <%= time_ago_in_words(submission.updated_at) %> ago
            </td>
            <td class="text-right">
              <div class="flex justify-end gap-2">
                <% if submission.status == "completed" %>
                  <%= link_to pdf_submission_path(submission), target: "_blank", class: "btn btn-ghost btn-sm btn-square text-info", "aria-label": "View PDF", title: "View PDF" do %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                  <% end %>
                  <%= link_to download_pdf_submission_path(submission), class: "btn btn-ghost btn-sm btn-square text-success", "aria-label": "Download PDF", title: "Download PDF" do %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                  <% end %>
                <% else %>
                  <%= link_to form_path(submission.form_definition), class: "btn btn-ghost btn-sm btn-square text-info", "aria-label": "Continue Editing", title: "Continue Editing" do %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  <% end %>
                <% end %>
                <%= button_to submission_path(submission), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this submission?" }, class: "btn btn-ghost btn-sm btn-square text-error", "aria-label": "Delete", title: "Delete" do %>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <%= render "shared/empty_state",
    icon: "document",
    title: "No submissions yet",
    message: "Get started by filling out a form.",
    action_path: forms_path,
    action_text: "Browse Forms" %>
<% end %>
</div>
