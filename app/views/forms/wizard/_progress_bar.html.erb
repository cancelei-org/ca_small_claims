<%# Wizard Progress Bar %>
<%# Uses @wizard_fields, @total_wizard_fields, @filled_count from controller %>

<%
  # Calculate progress values for ARIA
  wizard_total = @wizard_fields&.count || 0
  current_step = 1
  progress_percent = wizard_total > 0 ? (current_step.to_f / wizard_total * 100).round : 0
%>

<div class="mb-6">
  <%# Progress Bar with ARIA support %>
  <div class="w-full bg-base-200 rounded-full h-3 mb-3 overflow-hidden"
       role="progressbar"
       aria-valuenow="<%= progress_percent %>"
       aria-valuemin="0"
       aria-valuemax="100"
       aria-label="Form completion progress: <%= progress_percent %>% complete, question <%= current_step %> of <%= wizard_total %>"
       data-wizard-target="progressContainer">
    <div class="bg-gradient-to-r from-primary to-primary/80 h-3 rounded-full transition-all duration-500 ease-out"
         data-wizard-target="progress"
         style="width: <%= progress_percent %>%">
    </div>
  </div>

  <%# Counter and Status Row %>
  <div class="flex justify-between items-center text-sm">
    <%# Question Counter %>
    <div class="flex items-center gap-2">
      <span data-wizard-target="counter" class="font-medium text-base-content">
        1 / <%= @wizard_fields&.count || 0 %>
      </span>
      <span class="text-base-content/60">questions</span>
    </div>

    <%# Offline & Sync Status %>
    <div class="flex items-center gap-3">
      <%# Offline Indicator %>
      <div data-controller="offline-indicator" class="hidden">
        <div class="flex items-center gap-1">
          <span data-offline-indicator-target="icon"></span>
          <span data-offline-indicator-target="status"></span>
          <span data-offline-indicator-target="badge" class="hidden"></span>
        </div>
      </div>

      <%# Auto-save Status %>
      <div id="autosave-status" class="text-base-content/70" data-form-target="status">
        <%= render partial: "shared/autosave_status", locals: { saved_at: @submission.updated_at } %>
      </div>
    </div>
  </div>

  <%# Optional: Overall completion indicator %>
  <% if @total_wizard_fields && @total_wizard_fields > 0 %>
    <div class="mt-2 text-xs text-base-content/60 text-center">
      <% completion = ((@filled_count.to_f / @total_wizard_fields) * 100).round %>
      <%= completion %>% of form completed
    </div>
  <% end %>
</div>
