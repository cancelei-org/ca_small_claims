<% prefix ||= nil %>
<%= field_wrapper(field, prefix: prefix) do %>
  <% options = field.options.map { |opt| [opt["label"] || opt[:label], opt["value"] || opt[:value]] } %>
  <% searchable = options.length >= 5 %>

  <% if searchable %>
    <%# Searchable select for long option lists %>
    <div data-controller="searchable-select"
         data-searchable-select-placeholder-value="Type to filter..."
         data-searchable-select-no-results-value="No matching options">
      <%= form.select field.name,
        options_for_select(options, submission.field_value(field.name)),
        { include_blank: "Select..." },
        { required: field.required,
          class: standard_select_class,
          id: [ prefix, field.name.parameterize, "input" ].compact.join("-"),
          data: field_data_attributes.merge(searchable_select_target: "select"),
          **field_aria_attributes(field, prefix: prefix) } %>
    </div>
  <% else %>
    <%# Standard select for short option lists %>
    <%= form.select field.name,
      options_for_select(options, submission.field_value(field.name)),
      { include_blank: "Select..." },
      { required: field.required,
        class: standard_select_class,
        id: [ prefix, field.name.parameterize, "input" ].compact.join("-"),
        data: field_data_attributes,
        **field_aria_attributes(field, prefix: prefix) } %>
  <% end %>
<% end %>
