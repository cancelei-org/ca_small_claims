<%= tag.tr id: dom_id(feedback), class: "hover" do %>
  <td>
    <div class="font-medium"><%= feedback.form_definition.code %></div>
    <div class="text-xs opacity-60"><%= truncate(feedback.form_definition.title, length: 30) %></div>
  </td>

  <td>
    <div class="dropdown dropdown-hover">
      <div tabindex="0" role="button" class="badge <%= feedback.priority_badge_class %> badge-sm cursor-pointer">
        <%= feedback.priority_label %>
      </div>
      <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-32">
        <% FormFeedback::PRIORITIES.each do |p| %>
          <li>
            <%= button_to set_priority_admin_feedback_path(feedback, priority: p),
                          method: :patch,
                          class: "text-left #{p == feedback.priority ? 'font-bold' : ''}",
                          data: { turbo_stream: true } do %>
              <span class="badge <%= FormFeedback::PRIORITY_COLORS[p] %> badge-xs mr-1"></span>
              <%= p.titleize %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </td>

  <td>
    <div class="flex items-center gap-1">
      <% feedback.rating.times do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-warning">
          <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
        </svg>
      <% end %>
      <% (5 - feedback.rating).times do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-base-300">
          <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
        </svg>
      <% end %>
    </div>
  </td>

  <td>
    <div class="flex flex-wrap gap-1 max-w-xs">
      <% feedback.issue_types.first(2).each do |type| %>
        <span class="badge badge-ghost badge-sm"><%= FormFeedback::ISSUE_TYPES[type]&.truncate(20) || type %></span>
      <% end %>
      <% if feedback.issue_types.size > 2 %>
        <span class="badge badge-ghost badge-sm">+<%= feedback.issue_types.size - 2 %></span>
      <% end %>
    </div>
  </td>

  <td>
    <div class="text-sm"><%= time_ago_in_words(feedback.created_at) %> ago</div>
    <div class="text-xs opacity-60"><%= feedback.submitted_by %></div>
  </td>

  <td>
    <span class="badge <%= feedback.status_badge_class %> badge-sm"><%= feedback.status_label %></span>
  </td>

  <td class="text-right">
    <div class="flex items-center justify-end gap-1">
      <% if feedback.active? %>
        <% if feedback.open? %>
          <%= button_to start_progress_admin_feedback_path(feedback),
                        method: :patch,
                        class: "btn btn-ghost btn-xs",
                        title: "Start Progress",
                        data: { turbo_stream: true } do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" />
            </svg>
          <% end %>
        <% end %>

        <%= button_to resolve_admin_feedback_path(feedback),
                      method: :patch,
                      class: "btn btn-success btn-xs",
                      title: "Resolve",
                      data: { turbo_stream: true } do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
          </svg>
        <% end %>

        <%= button_to close_admin_feedback_path(feedback),
                      method: :patch,
                      class: "btn btn-ghost btn-xs",
                      title: "Close without resolution",
                      data: { turbo_stream: true } do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        <% end %>
      <% else %>
        <%= button_to reopen_admin_feedback_path(feedback),
                      method: :patch,
                      class: "btn btn-outline btn-xs",
                      title: "Reopen",
                      data: { turbo_stream: true } do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
        <% end %>
      <% end %>

      <%= link_to admin_feedback_path(feedback), class: "btn btn-ghost btn-xs", title: "View Details" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      <% end %>
    </div>
  </td>
<% end %>
